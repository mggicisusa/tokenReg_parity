<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/TokenReg.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> TokenReg.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.78% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>39/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">89.47% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>17/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.21% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>50/58</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-yes">9×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//! Token Registry contract.
//! By Roman Storm (rstormsf@gmail.com), 2017.
//! Released under the Apache Licence 2.
import './Ownable.sol';
&nbsp;
pragma solidity ^0.4.15;
&nbsp;
contract ERC20 {
 function decimals() public constant returns(uint256);
}
&nbsp;
contract TokenReg is Ownable {
 mapping(address =&gt; uint256) mapFromAddress;
 mapping(string =&gt; uint256) mapFromTLA;
 Token[] public tokens;
 uint256 public fee = 0.05 ether;
&nbsp;
 struct Token {
  address addr;
  string tla;
  uint256 base;
  string name;
  address owner;
  mapping(bytes32 =&gt; bytes32) meta;
 }
&nbsp;
 modifier when_fee_paid {
  <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.value &gt;= fee);
  _;
 }
 modifier when_address_free(address _addr) {
  <span class="missing-if-branch" title="else path not taken" >E</span>require(mapFromAddress[_addr] == 0);
  _;
 }
 modifier when_tla_free(string _tla) {
  require(mapFromTLA[_tla] == 0);
  _;
 }
&nbsp;
<span class="fstat-no" title="function not covered" > modifier when_has_tla(string _tla) {</span>
<span class="cstat-no" title="statement not covered" >  require(mapFromTLA[_tla] != 0)</span>;
  _;
 }
 modifier only_token_owner(uint256 _id) {
  <span class="missing-if-branch" title="else path not taken" >E</span>require(tokens[_id].owner == msg.sender);
  _;
 }
&nbsp;
 modifier validToken(address _addr, string _tla, string _name) {
  <span class="missing-if-branch" title="else path not taken" >E</span>require(_addr != 0x0);
  require(bytes(_tla).length &gt;= 3);
  require(bytes(_name).length &gt; 0);
  _;
 }
&nbsp;
 event Registered(string tla, uint256 indexed id, address addr, string name);
 event Unregistered(string tla, uint256 indexed id);
 event MetaChanged(uint256 indexed id, bytes32 indexed key, bytes32 value);
 event TokenRecordUpdated(uint256 indexed id, address _addr);
&nbsp;
 function register(address _addr, string _tla, string _name) public payable validToken(_addr, _tla, _name) returns(bool) {
  uint256 base = fetchErcValues(_addr);
  return registerAs(_addr, _tla, base, _name, msg.sender);
 }
&nbsp;
 function fetchErcValues(address _tokenAddr) public constant returns(uint256 base) {
  ERC20 erc20 = ERC20(_tokenAddr);
  base = 10 ** erc20.decimals();
 }
&nbsp;
 function registerAs(address _addr, string _tla, uint256 _base, string _name, address _owner) public payable when_fee_paid when_address_free(_addr) when_tla_free(_tla) returns(bool) {
  tokens.push(Token(_addr, _tla, _base, _name, _owner));
  mapFromAddress[_addr] = tokens.length;
  mapFromTLA[_tla] = tokens.length;
  Registered(_tla, tokens.length - 1, _addr, _name);
  return true;
 }
&nbsp;
 function unregister(uint256 _id) public onlyOwner {
  Unregistered(tokens[_id].tla, _id);
  delete mapFromAddress[tokens[_id].addr];
  delete mapFromTLA[tokens[_id].tla];
  delete tokens[_id];
  <span class="missing-if-branch" title="else path not taken" >E</span>if(tokens.length &gt; 0) {
    tokens.length--;
  }
 }
&nbsp;
 function setFee(uint256 _fee) public onlyOwner {
  fee = _fee;
 }
&nbsp;
 function tokenCount() public constant returns(uint256) {
  return tokens.length;
 }
&nbsp;
 function token(uint256 _id) public constant returns(address addr, string tla, uint256 base, string name, address owner) {
  var t = tokens[_id];
  addr = t.addr;
  tla = t.tla;
  base = t.base;
  name = t.name;
  owner = t.owner;
 }
&nbsp;
 function fromAddress(address _addr) public constant returns(uint256 id, string tla, uint256 base, string name, address owner) {
  id = mapFromAddress[_addr] - 1;
  var t = tokens[id];
  tla = t.tla;
  base = t.base;
  name = t.name;
  owner = t.owner;
 }
&nbsp;
<span class="fstat-no" title="function not covered" > function fromTLA(string _tla) public constant returns(uint256 id, address addr, uint256 base, string name, address owner) {</span>
<span class="cstat-no" title="statement not covered" >  id = mapFromTLA[_tla] - 1</span>;
<span class="cstat-no" title="statement not covered" >  var t = tokens[id];</span>
<span class="cstat-no" title="statement not covered" >  addr = t.addr</span>;
<span class="cstat-no" title="statement not covered" >  base = t.base</span>;
<span class="cstat-no" title="statement not covered" >  name = t.name</span>;
<span class="cstat-no" title="statement not covered" >  owner = t.owner</span>;
 }
&nbsp;
 function meta(uint256 _id, bytes32 _key) public constant returns(bytes32) {
  return tokens[_id].meta[_key];
 }
&nbsp;
 function setMeta(uint256 _id, bytes32 _key, bytes32 _value) public only_token_owner(_id) {
  tokens[_id].meta[_key] = _value;
  MetaChanged(_id, _key, _value);
 }
&nbsp;
 function updateToken(uint256 _id, address _newAddr) public only_token_owner(_id) {
  <span class="missing-if-branch" title="else path not taken" >E</span>require(_newAddr != 0x0);
  uint256 base = fetchErcValues(_newAddr);
  tokens[_id].addr = _newAddr;
  tokens[_id].base = base;
  TokenRecordUpdated(_id, _newAddr);
 }
&nbsp;
 function drain() public onlyOwner {
  owner.transfer(this.balance);
 }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Oct 07 2017 17:33:05 GMT-0700 (PDT)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
